{{ define "main" }}
  {{ if not .IsHome }}
    <div class="section-head">
      <h1>{{ .Title }}</h1>
      {{ with .Description }}<p>{{ . }}</p>{{ end }}
    </div>
  {{ end }}
  {{ $paginator := .Paginate (where .Pages "Section" "posts") }}
  {{ range $paginator.Pages }}
    <article class="post">
      <div class="post-header">
        <a class="post-title" href="{{ .RelPermalink }}" title="{{ .Title }}">{{ .Title }}</a>
        <div class="post-meta">
          <span class="meta-item">{{ .Date.Format "2006-01-02" }}</span>
          <em></em>
          <span class="meta-item">{{ partial "reading-time.html" . }} min read</span>
        </div>
      </div>
      <div class="post-desc">
        {{ $excerpt := "" }}
        {{ with .Params.summary }}
          {{ $excerpt = . }}
        {{ else }}
          {{ $firstPara := findRE `(?s)<p>.*?</p>` .Content 1 }}
          {{ if gt (len $firstPara) 0 }}
            {{ $excerpt = (index $firstPara 0 | plainify) }}
          {{ else }}
            {{ $excerpt = (.Summary | plainify) }}
          {{ end }}
        {{ end }}
        {{ $excerpt = ($excerpt | htmlUnescape | htmlUnescape | replaceRE `&[a-zA-Z0-9#]+;` " " | replaceRE `(?m)^#.*$` "" | replaceRE "`+" "" | replaceRE `\s+` " ") }}
        {{ $excerpt | truncate (default 200 $.Site.Params.summaryTruncate) }}
      </div>
    </article>
  {{ end }}
  {{ if gt $paginator.TotalPages 1 }}
    <nav class="page-navigator">
      <ul>
        {{ if $paginator.HasPrev }}
          <li><a href="{{ $paginator.Prev.URL }}">Prev</a></li>
        {{ end }}
        {{ range $paginator.Pagers }}
          <li class="{{ if eq . $paginator }}current{{ end }}"><a href="{{ .URL }}">{{ .PageNumber }}</a></li>
        {{ end }}
        {{ if $paginator.HasNext }}
          <li><a href="{{ $paginator.Next.URL }}">Next</a></li>
        {{ end }}
      </ul>
    </nav>
  {{ end }}
{{ end }}
